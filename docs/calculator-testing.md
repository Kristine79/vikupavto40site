# Тестирование калькулятора АвтоВыкуп40

## Обзор

Калькулятор стоимости автомобиля полностью протестирован с помощью Jest. Все функции работают корректно.

## Запуск тестов

```bash
# Запустить все тесты
bun test

# Запустить тесты в режиме watch
bun test:watch

# Запустить тесты с покрытием кода
bun test:coverage
```

## Результаты тестирования

✅ **56 тестов пройдено успешно**
- 35 тестов основных функций калькулятора
- 21 тест функциональности кнопки "Рассчитать стоимость"

## Протестированные функции

### 1. Расчет цены (Price Calculation)
- ✅ Базовая цена по марке автомобиля
- ✅ Амортизация по году выпуска
- ✅ Корректировка по пробегу
- ✅ Множитель типа двигателя (бензин/дизель/электро/гибрид)
- ✅ Множитель состояния (отличное/хорошее/удовлетворительное/плохое)
- ✅ Множитель истории ДТП
- ✅ Множитель наличия документов
- ✅ Минимальная цена 100,000 ₽

### 2. Оценка повреждений (Damage Assessment)
- ✅ База данных стоимости ремонта
- ✅ Множители по маркам (премиум дороже, бюджет дешевле)
- ✅ Расчет общей стоимости повреждений
- ✅ Вычитание стоимости ремонта из цены

### 3. Валидация формы (Form Validation)
- ✅ Проверка обязательного поля "Марка"
- ✅ Проверка обязательного поля "Год"
- ✅ Отключение кнопки при пустой марке
- ✅ Отключение кнопки при пустом годе
- ✅ Включение кнопки при заполненных полях

### 4. Загрузка фото (Photo Upload)
- ✅ Ограничение до 5 фотографий
- ✅ Сброс зон повреждений при изменении фото

### 5. Интеграция с API (API Integration)
- ✅ Вызов API ремонта с корректными данными
- ✅ Обработка ошибок API с fallback

### 6. Интеграция с Telegram
- ✅ Форматирование сообщения
- ✅ Кодирование сообщения для URL

### 7. Выбор марки и модели
- ✅ База данных марок автомобилей
- ✅ Фильтрация моделей по марке
- ✅ Ограничение автодополнения до 10 вариантов

### 8. Состояние UI
- ✅ Отображение состояния загрузки
- ✅ Отображение результата
- ✅ Отображение состояния анализа
- ✅ Отображение зон повреждений

### 9. Граничные случаи (Edge Cases)
- ✅ Очень старый автомобиль (максимальная амортизация)
- ✅ Марка не в базе данных
- ✅ Пустые зоны повреждений
- ✅ Отрицательная расчетная цена

### 10. Функциональность кнопки
- ✅ Управление состоянием кнопки
- ✅ Обработчик клика
- ✅ Отображение текста кнопки
- ✅ Полный рабочий процесс расчета
- ✅ Обработка ошибок
- ✅ Интеграция с оценкой повреждений

## Проверенные сценарии

### Сценарий 1: Базовый расчет
1. Пользователь выбирает марку "Toyota"
2. Пользователь выбирает модель "Camry"
3. Пользователь выбирает год "2020"
4. Пользователь вводит пробег "50,000 км"
5. Кнопка "Рассчитать стоимость" активна
6. Пользователь нажимает кнопку
7. Система рассчитывает цену
8. Отображается результат

**Результат:** ✅ Работает корректно

### Сценарий 2: Расчет с повреждениями
1. Пользователь заполняет форму
2. Пользователь загружает фото
3. Пользователь выбирает поврежденные части
4. Система рассчитывает стоимость ремонта
5. Пользователь нажимает "Рассчитать стоимость"
6. Система вычитает стоимость ремонта из цены
7. Отображается итоговая цена

**Результат:** ✅ Работает корректно

### Сценарий 3: Обработка ошибок
1. API недоступен
2. Система использует fallback расчет
3. Отображается ориентировочная цена

**Результат:** ✅ Работает корректно

## Известные ограничения

1. **Кнопка отключена без марки и года** - это ожидаемое поведение для валидации формы
2. **API может быть недоступен** - система использует fallback с ориентировочными ценами
3. **Максимум 5 фотографий** - ограничение для оптимизации производительности

## Рекомендации по использованию

### Для пользователей:
1. Обязательно заполните поля "Марка" и "Год"
2. Остальные поля опциональны, но влияют на точность расчета
3. Загрузите фото для более точной оценки повреждений
4. Выберите поврежденные части вручную

### Для разработчиков:
1. Запускайте тесты перед каждым коммитом
2. Добавляйте новые тесты при добавлении функций
3. Проверяйте покрытие кода с помощью `bun test:coverage`
4. Следите за состоянием кнопки в зависимости от заполнения формы

## Отладка проблем

### Кнопка "Рассчитать стоимость" не активна

**Причина:** Не заполнены обязательные поля

**Решение:**
1. Проверьте, что выбрана марка автомобиля
2. Проверьте, что выбран год выпуска
3. Убедитесь, что марка не "Другая"

### Расчет не выполняется

**Причина:** Ошибка в API или JavaScript

**Решение:**
1. Откройте консоль браузера (F12)
2. Проверьте наличие ошибок
3. Проверьте сетевые запросы во вкладке Network
4. Система автоматически использует fallback при ошибках API

### Неверная цена

**Причина:** Неправильные входные данные

**Решение:**
1. Проверьте правильность заполнения всех полей
2. Убедитесь, что выбраны корректные повреждения
3. Помните, что это предварительная оценка
4. Точная цена определяется после осмотра

## Контакты для поддержки

- Telegram: @krisdev13
- Телефон: +7 (XXX) XXX-XX-XX

## История изменений

### 2026-02-15
- ✅ Создана полная тестовая система
- ✅ Добавлено 56 тестов
- ✅ Все тесты проходят успешно
- ✅ Проверена работа кнопки "Рассчитать стоимость"
- ✅ Проверена интеграция с API
- ✅ Проверен fallback механизм
